@startuml Bezique

/'! $CONFIG : toml
SmRunnerSettings.transpilerId = "CSharp"

[RenderConfig.CSharp]
NameSpace = "BeziqueCore;"
'/

hide empty description
skinparam stateMessageAlignment center

' ///////////////////////////// STATE ORGANIZATION ///////////////////////

[*] -> Deal

state Deal {
    [*] -> DealFirst

    state DealFirst
    state DealMid
    state DealLast

    DealFirst : enter / _adapter.DealFirstCard();
    DealFirst -> DealMid : Complete

    DealMid : enter / _adapter.DealMidCard();
    DealMid -> DealLast : Complete

    DealLast : enter / _adapter.DealLastCard();
    DealLast -> SelectTrump : Complete
}

state SelectTrump
SelectTrump : enter / _adapter.SelectTrump();
SelectTrump --> Play : Complete

state Play {
    [*] -> PlayFirst

    state PlayFirst
    state PlayMid
    state PlayLast

    PlayFirst : enter / _adapter.PlayFirstCard();
    PlayFirst -> PlayMid : HasMid
    PlayFirst -> PlayLast : Complete

    PlayMid : enter / _adapter.PlayMidCard();
    PlayMid -> PlayLast : Complete

    PlayLast : enter / _adapter.PlayLastCard();
    PlayLast --> Meld : Complete
}

state Meld {
    [*] -> TryMelded

    state TryMelded
    state Melded
    state NoMeld

    TryMelded : enter / _adapter.TryMeld();
    TryMelded -> Melded : Success
    TryMelded -> NoMeld : Failed

    Melded : enter / _adapter.MeldSuccess();
    Melded -> AddPoint : Complete

    NoMeld : enter / _adapter.MeldFailed();
    NoMeld --> NewTrick : Complete
}

state AddPoint
AddPoint : enter / _adapter.AddMeldPoints();
AddPoint --> NewTrick : Complete

state NewTrick
NewTrick : enter / _adapter.StartNewTrick();
NewTrick -> AddOneCardToAll : Complete
NewTrick --> GameOver : WinningScore

state AddOneCardToAll
AddOneCardToAll : enter / _adapter.DealCardsToAll();
AddOneCardToAll --> Play : Complete
AddOneCardToAll --> L9Play : DeckEmpty

state L9Play {
    [*] -> L9PlayFirst

    state L9PlayFirst
    state L9PlayMid
    state L9PlayLast

    L9PlayFirst : enter / _adapter.L9PlayFirstCard();
    L9PlayFirst --> L9PlayMid : HasMid
    L9PlayFirst --> L9PlayLast : Complete

    L9PlayMid : enter / _adapter.L9PlayMidCard();
    L9PlayMid --> L9PlayLast : Complete

    L9PlayLast : enter / _adapter.L9PlayLastCard();
    L9PlayLast --> L9NewTrick : Complete
}

state L9NewTrick
L9NewTrick : enter / _adapter.StartL9NewTrick();
L9NewTrick --> L9Play : Complete
L9NewTrick --> RoundEnd : NoCard
L9NewTrick --> GameOver : WinningScore

state RoundEnd
RoundEnd : enter / _adapter.EndRound();
RoundEnd -> CalculatePoint : Complete

state CalculatePoint
CalculatePoint : enter / _adapter.CalculatePoints();
CalculatePoint --> Deal : Complete
CalculatePoint --> GameOver : WinningScore

state GameOver
GameOver : enter / _adapter.GameOver();

@enduml
